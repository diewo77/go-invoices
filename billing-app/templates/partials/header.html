{{ define "header" }}
<header
  class="sticky top-0 z-40 w-full backdrop-blur bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700 text-white shadow"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-14 items-center justify-between gap-4">
      <!-- Left: Brand + (Desktop) Nav -->
      <div class="flex items-center gap-6 min-w-0">
        <a
          href="/"
          class="shrink-0 font-semibold tracking-wide text-sm md:text-base flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70 rounded"
        >
          <span class="inline-block">Billing App</span>
        </a>
        <!-- Desktop Nav -->
        <nav
          class="hidden md:flex md:items-center md:gap-1"
          aria-label="Main navigation"
          id="navMenuDesktop"
        >
          {{ if .User }}
          <a href="/dashboard" class="nav-link">{{ t "nav_dashboard" }}</a>
          <a href="/products" class="nav-link">{{ t "nav_products" }}</a>
          <a href="/invoices" class="nav-link">{{ t "nav_invoices" }}</a>
          <a href="/setup" class="nav-link">{{ t "nav_settings" }}</a>
          <a href="/profile" class="nav-link">{{ t "shortcut_profile" }}</a>
          <a href="/logout" class="nav-link">{{ t "nav_logout" }}</a>
          {{ else }}
          <a href="/login" class="nav-link">{{ t "nav_login" }}</a>
          <a href="/signup" class="nav-link">{{ t "nav_signup" }}</a>
          {{ end }}
        </nav>
      </div>

      <!-- Right: Utilities -->
      <div class="flex items-center gap-2">
        <div class="hidden md:flex items-center gap-1">
          <a href="?lang=fr" class="lang-link">FR</a>
          <a href="?lang=en" class="lang-link">EN</a>
          <span class="opacity-60 text-xs px-1">|</span>
          <button
            type="button"
            id="themeToggle"
            title="Cycle theme"
            class="lang-link border border-white/30"
          >
            ðŸŒ“
          </button>
        </div>
        <!-- Mobile toggle -->
        <button
          type="button"
          id="navToggle"
          class="md:hidden inline-flex items-center justify-center rounded-md p-2 hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white/70 focus-visible:ring-offset-transparent"
          aria-controls="navMenuMobile"
          aria-expanded="false"
        >
          <span class="sr-only">Toggle navigation</span>
          <svg
            class="h-5 w-5"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
  <!-- Mobile Menu -->
  <div
    id="navMenuMobile"
    class="md:hidden hidden border-t border-white/15 bg-gradient-to-b from-blue-600/95 to-indigo-700/95 backdrop-blur-sm"
  >
    <nav
      class="px-4 pt-3 pb-4 flex flex-col gap-1 text-sm"
      aria-label="Mobile navigation"
    >
      {{ if .User }}
      <a href="/dashboard" class="nav-mobile-link">{{ t "nav_dashboard" }}</a>
      <a href="/products" class="nav-mobile-link">{{ t "nav_products" }}</a>
      <a href="/invoices" class="nav-mobile-link">{{ t "nav_invoices" }}</a>
      <a href="/setup" class="nav-mobile-link">{{ t "nav_settings" }}</a>
      <a href="/profile" class="nav-mobile-link">{{ t "shortcut_profile" }}</a>
      <a href="/logout" class="nav-mobile-link">{{ t "nav_logout" }}</a>
      {{ else }}
      <a href="/login" class="nav-mobile-link">{{ t "nav_login" }}</a>
      <a href="/signup" class="nav-mobile-link">{{ t "nav_signup" }}</a>
      {{ end }}
      <div class="mt-3 flex items-center gap-2">
        <a href="?lang=fr" class="lang-chip">FR</a>
        <a href="?lang=en" class="lang-chip">EN</a>
        <button
          type="button"
          id="themeToggleMobile"
          title="Cycle theme"
          class="lang-chip border border-white/30"
        >
          ðŸŒ“
        </button>
      </div>
    </nav>
  </div>
  <script>
    // Tailwind navbar interactivity (scoped to header)
    (function () {
      const toggle = document.getElementById("navToggle");
      const menu = document.getElementById("navMenuMobile");
      if (toggle && menu) {
        toggle.addEventListener("click", () => {
          const isHidden = menu.classList.toggle("hidden");
          toggle.setAttribute("aria-expanded", (!isHidden).toString());
        });
      }
      // Mirror theme toggle for mobile if present
      const mainToggle = document.getElementById("themeToggle");
      const mobileToggle = document.getElementById("themeToggleMobile");
      if (mainToggle && mobileToggle) {
        mobileToggle.addEventListener("click", () => mainToggle.click());
      }
      // Utility: apply active styles based on current path (best-effort)
      try {
        const current = window.location.pathname;
        document
          .querySelectorAll("a.nav-link, a.nav-mobile-link")
          .forEach((a) => {
            if (a.getAttribute("href") === current) {
              a.classList.add("active");
            }
          });
      } catch (_) {}
    })();
  </script>
  <style>
    /* Utility approximations (since Tailwind @apply isn't processed inline) */
    header a.nav-link,
    header a.nav-mobile-link,
    header .lang-link,
    header .lang-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      border-radius: 0.375rem;
      font-weight: 500;
      line-height: 1.2;
      text-decoration: none;
      transition: background 0.15s, color 0.15s;
    }
    header a.nav-link {
      font-size: 0.75rem;
      padding: 0.5rem 0.75rem;
    }
    header a.nav-mobile-link {
      font-size: 0.875rem;
      padding: 0.5rem 0.75rem;
    }
    header .lang-link,
    header .lang-chip {
      font-size: 0.625rem;
      padding: 0.25rem 0.5rem;
    }
    header a.nav-link:hover,
    header a.nav-mobile-link:hover,
    header .lang-link:hover,
    header .lang-chip:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    header a.nav-link.active,
    header a.nav-mobile-link.active {
      background: rgba(255, 255, 255, 0.15);
    }
  </style>
</header>
{{ end }}
