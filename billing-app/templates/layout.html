<!DOCTYPE html>
<html lang="{{ lang }}" data-theme="{{ theme }}" class="min-h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ block "title" . }}Billing App{{ end }}</title>
    <meta name="description" content="{{ t "home_meta_desc" }}" /> {{ block
    "meta" . }}{{ end }} <link rel="preload" href="{{ asset "tailwind.css" }}"
    as="style" /> <link rel="stylesheet" href="{{ asset "tailwind.css" }}" /> {{
    block "head_end" . }}{{ end }}
  </head>
  <body
    id="appRoot"
    class="min-h-screen flex flex-col bg-base-200 text-base-content"
  >
    <a href="#main" class="sr-only focus:not-sr-only btn btn-primary btn-xs m-2"
      >Skip to content</a
    >

    <header
      role="banner"
      class="mb-4 shadow-sm bg-base-100/80 backdrop-blur supports-[backdrop-filter]:bg-base-100/60"
    >
      {{ template "header" . }}
    </header>

    <div class="flex-1 w-full" id="main" role="main">
      {{ block "content" . }}{{ end }}
    </div>

    {{ block "footer" . }}
    <footer
      role="contentinfo"
      class="mt-10 text-center py-6 text-xs text-base-content/60"
    >
      &copy; {{ if .Year }}{{ .Year }}{{ end }} Billing App
    </footer>
    {{ end }}

    <script>
      (function () {
        const cookie = (n, v, d) => {
          if (v === undefined)
            return (document.cookie.match(
              "(^|;)\\s*" + n + "\\s*=\\s*([^;]+)"
            ) || 0)[2];
          const dt = new Date();
          dt.setTime(dt.getTime() + d * 864e5);
          document.cookie = n + "=" + v + ";path=/;max-age=" + d * 86400;
        };
        const root = document.documentElement;
        // Guard: ensure DaisyUI theme variables are present; if not, log a warning.
        const hasDaisy = () => {
          const style = getComputedStyle(root);
          return !!style.getPropertyValue("--p").trim();
        };
        if (!hasDaisy()) {
          // Defer a second check after load (in case CSS still streaming)
          window.addEventListener("load", () => {
            if (!hasDaisy())
              console.warn(
                "[theme] DaisyUI CSS variables missing; ensure Tailwind build ran with daisyui plugin."
              );
          });
        }
        const normalized = (val) => (val === "dark" ? "dark" : "light");
        let pref = cookie("theme");
        if (pref !== "light" && pref !== "dark") {
          // Treat unknown/system values by detecting system preference, then store 'light'/'dark'.
          pref = matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        }
        root.dataset.theme = normalized(pref);
        const btn = document.getElementById("themeToggle");
        const apply = (mode) => {
          root.dataset.theme = normalized(mode);
          cookie("theme", normalized(mode), 365);
          if (btn)
            btn.setAttribute(
              "aria-label",
              "Switch to " +
                (root.dataset.theme === "light" ? "dark" : "light") +
                " mode"
            );
        };
        btn?.addEventListener("click", () => {
          const next = root.dataset.theme === "light" ? "dark" : "light";
          apply(next);
        });
        // Listen to system changes only if user never explicitly toggled (no cookie set yet)
        if (!cookie("theme")) {
          const mq = matchMedia("(prefers-color-scheme: dark)");
          mq.addEventListener("change", (e) =>
            apply(e.matches ? "dark" : "light")
          );
        }
      })();
    </script>
    {{ block "body_end" . }}{{ end }}
  </body>
</html>
