{{ define "title" }}{{ t "dashboard_title" }}{{ end }} {{ define "content" }}
<main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 space-y-8">
  <section
    class="card bg-base-100 shadow-sm border border-base-200 space-y-2 p-6"
  >
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
    >
      <div>
        <h1
          class="text-2xl font-semibold tracking-tight flex items-center gap-2"
        >
          {{ t "dashboard_welcome_prefix" }}{{ if or .User.Prenom .User.Nom }},
          {{ .User.Prenom }} {{ .User.Nom }}{{ end }} ðŸ‘‹
        </h1>
        <p class="text-sm text-slate-600 dark:text-slate-300">
          {{ t "dashboard_overview" }}
        </p>
      </div>
      <div
        class="flex items-center gap-2 text-xs text-slate-700 dark:text-slate-300"
      >
        <span
          class="inline-flex items-center gap-1 rounded-full bg-blue-600/10 text-blue-100 px-3 py-1 font-medium"
        >
          ðŸ‘¤ {{ if or .User.Prenom .User.Nom }}{{ .User.Prenom }} {{ .User.Nom
          }}{{ else }}User #{{ .User.ID }}{{ end }}
        </span>
        <a href="/setup" class="btn btn-outline btn-xs normal-case"
          >{{ t "nav_settings" }}</a
        >
        <a href="/logout" class="btn btn-outline btn-xs normal-case"
          >{{ t "nav_logout" }}</a
        >
      </div>
    </div>
    {{ if .Flash }}
    <div
      id="flash"
      class="rounded-md border border-blue-300/40 bg-blue-50 text-blue-700 dark:border-blue-400/30 dark:bg-blue-900/30 dark:text-blue-200 px-4 py-2 text-sm"
    >
      {{ .Flash }}
    </div>
    {{ end }}
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <div class="space-y-2">
        <h3 class="font-semibold">{{ t "company_profile_title" }}</h3>
        {{ if .Company }}
        <p class="text-sm font-medium">
          {{ or .Company.NomCommercial .Company.RaisonSociale }}
        </p>
        <ul class="text-xs text-slate-600 dark:text-slate-300 leading-relaxed">
          <li><span class="font-medium">SIREN:</span> {{ .Company.SIREN }}</li>
          <li>
            <span class="font-medium">Capital:</span> {{ .Company.Capital }}
          </li>
          <li>
            <span class="font-medium">Adresse:</span> {{ .Company.Address.Ligne1
            }} {{ .Company.Address.CodePostal }} {{ .Company.Address.Ville }}
          </li>
        </ul>
        {{ else }}
        <p class="text-xs italic text-slate-500 dark:text-slate-400">
          {{ t "company_not_configured" }}
          <a
            href="/setup"
            class="underline hover:text-blue-600 dark:hover:text-blue-400"
            >{{ t "company_complete_setup" }}</a
          >.
        </p>
        {{ end }}
      </div>
      <div class="space-y-2">
        <h3 class="font-semibold">{{ t "quick_actions_title" }}</h3>
        <div class="flex flex-wrap gap-2">
          <a class="btn btn-primary btn-sm normal-case" href="/invoices/new"
            >{{ t "action_new_invoice" }}</a
          >
          <a class="btn btn-outline btn-sm normal-case" href="/clients"
            >{{ t "action_clients" }}</a
          >
          <a class="btn btn-outline btn-sm normal-case" href="/reports"
            >{{ t "action_reports" }}</a
          >
        </div>
      </div>
      <div class="space-y-2">
        <h3 class="font-semibold">{{ t "stats_title" }}</h3>
        <ul class="text-xs text-slate-600 dark:text-slate-300 leading-relaxed">
          <li>
            {{ t "stats_invoices" }}: {{ if .Stats }}{{ index .Stats
            "InvoiceCount" }}{{ else }}0{{ end }}
          </li>
          <li>
            {{ t "stats_clients" }}: {{ if .Stats }}{{ index .Stats
            "ClientCount" }}{{ else }}0{{ end }}
          </li>
          <li>
            {{ t "stats_products" }}: {{ if .Stats }}{{ index .Stats
            "ProductCount" }}{{ else }}0{{ end }}
          </li>
        </ul>
      </div>
    </div>
  </section>

  <section class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    <div
      class="card bg-base-100 shadow-sm border border-base-200 space-y-3 p-5"
    >
      <h3 class="font-semibold">{{ t "recent_products_title" }}</h3>
      {{ if .RecentProducts }}
      <div class="overflow-x-auto -mx-2 sm:mx-0">
        <table class="min-w-full text-xs sm:text-sm">
          <thead
            class="text-left text-slate-600 dark:text-slate-300 border-b border-slate-200 dark:border-slate-700"
          >
            <tr>
              <th class="py-2 pr-4">
                {{ if eq (lang) "fr" }}Nom{{ else }}Name{{ end }}
              </th>
              <th class="py-2 pr-4">
                {{ if eq (lang) "fr" }}Prix{{ else }}Price{{ end }}
              </th>
              <th class="py-2 pr-2">
                {{ if eq (lang) "fr" }}TVA{{ else }}VAT{{ end }}
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 dark:divide-slate-700">
            {{ range .RecentProducts }}
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/40">
              <td class="py-2 pr-4 font-medium">{{ .Name }}</td>
              <td class="py-2 pr-4">{{ printf "%.2f" .UnitPrice }}</td>
              <td class="py-2 pr-2">
                {{ printf "%.0f%%" (mul .VATRate 100) }}
              </td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ else }}
      <p class="text-sm text-slate-500 dark:text-slate-400">
        <em>{{ t "no_products" }}</em>
      </p>
      {{ end }}
    </div>
    <div
      class="card bg-base-100 shadow-sm border border-base-200 space-y-3 p-5"
    >
      <h3 class="font-semibold">{{ t "recent_invoices_title" }}</h3>
      {{ if .RecentInvoices }}
      <ul class="m-0 pl-5 text-xs leading-relaxed list-disc">
        {{ range .RecentInvoices }}
        <li>#{{ .ID }} - {{ .Status }} - {{ .CreatedAt.Format "02 Jan" }}</li>
        {{ end }}
      </ul>
      {{ else }}
      <p class="text-sm text-slate-500 dark:text-slate-400">
        <em>{{ t "no_invoices" }}</em>
      </p>
      {{ end }}
    </div>
    <div
      class="card bg-base-100 shadow-sm border border-base-200 space-y-3 p-5"
    >
      <h3 class="font-semibold">{{ t "shortcuts_title" }}</h3>
      <ul class="m-0 pl-5 text-xs leading-relaxed list-disc">
        <li>
          <a href="/setup" class="hover:underline"
            >{{ t "shortcut_edit_company" }}</a
          >
        </li>
        <li>
          <a href="/profile" class="hover:underline"
            >{{ t "shortcut_profile" }}</a
          >
        </li>
        <li>
          <a href="/invoices" class="hover:underline"
            >{{ t "shortcut_view_invoices" }}</a
          >
        </li>
        <li>
          <a href="/settings" class="hover:underline"
            >{{ t "shortcut_account_settings" }}</a
          >
        </li>
      </ul>
    </div>
  </section>
</main>
<script>
  setTimeout(() => {
    const el = document.getElementById("flash");
    if (!el) return;
    el.style.transition = "opacity .45s";
    el.style.opacity = "0";
    setTimeout(() => el.remove(), 450);
  }, 3000);
</script>
{{ end }}
