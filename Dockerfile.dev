# Development Dockerfile with hot reload
FROM golang:1.25-alpine

WORKDIR /app

# Install development tools
RUN apk add --no-cache git
RUN go install github.com/cespare/reflex@latest

# Copy go.work and modules (will be overridden by volume mounts)
COPY go.work go.work.sum ./

COPY auth/ ./auth/
COPY httpx/ ./httpx/
COPY i18n/ ./i18n/
COPY validation/ ./validation/
COPY view/ ./view/
COPY go-gate/ ./go-gate/
COPY go-pdf/ ./go-pdf/
COPY go-invoices/ ./go-invoices/

# Download dependencies
WORKDIR /app/go-invoices
RUN go mod download

WORKDIR /app

# Expose port
EXPOSE 8080

# Run with reflex for hot reload
CMD reflex -r '\.go$' -s -- sh -c "cd /app/go-invoices && go run ./cmd/server"
